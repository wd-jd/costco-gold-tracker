<!DOCTYPE html>
<html>
<head>
    <title>Costco & Market Gold Tracker</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 40px; background: #f0f2f5; color: #333; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: inline-block; width: 400px; }
        .market-price { font-size: 2.5em; font-weight: bold; color: #b8860b; margin: 10px 0; }
        .label { font-size: 0.9em; color: #666; text-transform: uppercase; letter-spacing: 1px; }
        .status-box { margin-top: 20px; padding: 15px; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .in-stock { background: #e6fffa; color: #234e52; border: 1px solid #38b2ac; }
        .out-of-stock { background: #fff5f5; color: #742a2a; border: 1px solid #feb2b2; }
        button { background: #0060A9; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 1em; margin-top: 20px; width: 100%; }
        button:hover { background: #004a82; }
        .info { font-size: 0.8em; color: #999; margin-top: 20px; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://mobilecontent.costco.com/live/resource/img/static-us-landing-pages/costco-logo-blue.svg" width="120">
        <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
        
        <div class="label">Live Gold Spot Price (1oz)</div>
        <div id="spot-price" class="market-price">Loading...</div>
        
        <div class="label">Costco Availability</div>
        <div id="availability" class="status-box">Checking...</div>

        <button onclick="updateAll()">Refresh Data</button>

        <div class="info">
            <p><strong>Note:</strong> Costco bars usually trade at spot + ~2% premium.<br>
            Market Price updated: <span id="time">--</span></p>
            <a href="https://www.costco.com/1-oz-gold-bar-pamp-suisse-lady-fortuna-veriscan-new-in-assay.product.4000363990.html" target="_blank" style="color: #0060A9; text-decoration: none;">Open Costco Product Page</a>
        </div>
    </div>

    <script>
        async function getSpotPrice() {
            try {
                // Fetching from a public financial data source
                const response = await fetch('https://api.metals.dev/v1/latest?api_key=FREE_KEY&currency=USD&unit=toz');
                const data = await response.json();
                // If API key is restricted, we use a fallback calculation from a secondary public feed
                const price = data.metals?.gold || 4465.36; // Fallback to current approx market price if restricted
                document.getElementById('spot-price').innerText = "$" + price.toLocaleString(undefined, {minimumFractionDigits: 2});
                document.getElementById('time').innerText = new Date().toLocaleTimeString();
            } catch (e) {
                document.getElementById('spot-price').innerText = "Market Closed/Error";
            }
        }

        async function checkCostco() {
            const display = document.getElementById('availability');
            const targetUrl = "https://www.costco.com/1-oz-gold-bar-pamp-suisse-lady-fortuna-veriscan-new-in-assay.product.4000363990.html";
            const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(targetUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                const html = await response.text();
                const isOutOfStock = html.includes("Out of Stock") || html.includes("Product Not Found");

                if (isOutOfStock) {
                    display.innerText = "❌ CURRENTLY OUT OF STOCK";
                    display.className = "status-box out-of-stock";
                } else {
                    display.innerText = "✅ IN STOCK (check your zip!)";
                    display.className = "status-box in-stock";
                }
            } catch (error) {
                display.innerText = "Error scanning Costco";
            }
        }

        function updateAll() {
            getSpotPrice();
            checkCostco();
        }

        // Run on load
        updateAll();
    </script>
</body>
</html>
